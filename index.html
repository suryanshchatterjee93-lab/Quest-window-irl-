<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quest Window</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#0b0014">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet">
<style>
:root { --glow: #4fc3ff; }
body { margin:0; font-family:'Orbitron',sans-serif; background:radial-gradient(circle at top,#12001f,#040008); color:#e6e6ff; }
.container { max-width:430px; margin:30px auto; background:rgba(15,0,30,0.9); border-radius:18px; box-shadow:0 0 30px var(--glow); padding:20px; }
h1 { text-align:center; color:var(--glow); margin-bottom:8px; }
.panel { border:1px solid var(--glow); border-radius:14px; padding:12px; margin-bottom:14px; text-align:center; }
button { background:linear-gradient(135deg,var(--glow),#ffffff); border:none; border-radius:10px; color:#000; padding:6px 12px; font-family:inherit; cursor:pointer; margin:4px; }
button:disabled { opacity:0.4; cursor:not-allowed; }
.system-msg { font-size:0.9em; color:var(--glow); margin-top:8px; min-height:24px; }
.log { max-height:120px; overflow-y:auto; font-size:0.75em; background:rgba(0,0,0,0.4); padding:6px; border-radius:8px; margin-top:10px; text-align:left; }
.notification { position:fixed; top:20px; right:20px; background:rgba(0,0,0,0.85); color:#fff; padding:12px 18px; border-radius:10px; box-shadow:0 0 20px var(--glow); font-weight:600; display:none; z-index:1000; }
.flicker { animation: flicker 0.5s infinite alternate; }
@keyframes flicker {
  from { text-shadow: 0 0 4px var(--glow); }
  to { text-shadow: 0 0 15px var(--glow); }
}
</style>
</head>
<body>

<div class="container">
  <h1>【 QUEST WINDOW 】</h1>
  <div class="panel">
    <strong>ACTIVE QUEST</strong>
    <div class="system-msg" id="quest-text">No active quest</div>
    <button id="accept-btn">Accept Quest</button>
    <button id="complete-btn">Complete Quest</button>
  </div>

  <div class="panel">
    <strong>DAILY QUESTS</strong>
    <div id="daily-list"></div>
  </div>

  <div class="panel">
    <strong>BONUS QUESTS</strong>
    <div id="bonus-list"></div>
  </div>

  <div class="panel">
    <strong>STREAK</strong>
    <div class="system-msg" id="streak-box">0</div>
  </div>

  <div class="panel">
    <strong>LOG</strong>
    <div class="log" id="history"></div>
  </div>
</div>

<div class="notification" id="notification"></div>

<script>
/* ================= CORE STATE ================= */
var dailyQuests = [
  { name: "Workout", reward: 10, done:false },
  { name: "Study", reward: 10, done:false },
  { name: "Meditate", reward: 10, done:false }
];

var bonusQuests = [
  { name: "Kyokushin Practice", reward: 5, done:false },
  { name: "Muay Thai Drills", reward: 5, done:false },
  { name: "Boxing Footwork", reward: 5, done:false }
];

var currentQuest = null;
var streak = 0;
var logHistory = [];

/* ================= SAVE / LOAD ================= */
function saveGame(){
  localStorage.setItem('questWindowSave', JSON.stringify({
    dailyQuests, bonusQuests, streak
  }));
}

function loadGame(){
  var raw = localStorage.getItem('questWindowSave');
  if(!raw) return;
  var d = JSON.parse(raw);
  dailyQuests = d.dailyQuests || dailyQuests;
  bonusQuests = d.bonusQuests || bonusQuests;
  streak = d.streak || streak;
}

/* ================= NOTIFY / LOG ================= */
function notify(msg){
  var n = document.getElementById('notification');
  n.innerText = msg;
  n.style.display = 'block';
  setTimeout(()=>n.style.display='none',3500);
  log(msg);
}

function log(msg){
  logHistory.push(msg);
  var h = document.getElementById('history');
  h.innerHTML = logHistory.slice(-10).map(x => `[${new Date().toLocaleTimeString()}] ${x}`).join("<br>");
}

/* ================= QUEST FUNCTIONS ================= */
function renderQuests(){
  var dailyDiv = document.getElementById('daily-list');
  dailyDiv.innerHTML = '';
  dailyQuests.forEach((q,i)=>{
    var btn = `<button ${q.done?'disabled':''} onclick="completeDaily(${i})">${q.done?'✔':'Do'}</button>`;
    dailyDiv.innerHTML += `<div>${q.name} - Reward: ${q.reward} EXP ${btn}</div>`;
  });

  var bonusDiv = document.getElementById('bonus-list');
  bonusDiv.innerHTML = '';
  bonusQuests.forEach((q,i)=>{
    var btn = `<button ${q.done?'disabled':''} onclick="completeBonus(${i})">${q.done?'✔':'Do'}</button>`;
    bonusDiv.innerHTML += `<div>${q.name} - Reward: ${q.reward} EXP ${btn}</div>`;
  });

  document.getElementById('streak-box').innerText = streak;
}

function acceptQuest(){
  if(currentQuest) {
    notify("Already have an active quest!");
    return;
  }
  // Pick a random quest
  var allQuests = [...dailyQuests,...bonusQuests].filter(q=>!q.done);
  if(allQuests.length===0){
    notify("No quests available!");
    return;
  }
  currentQuest = allQuests[Math.floor(Math.random()*allQuests.length)];
  document.getElementById('quest-text').innerText = currentQuest.name + " → Reward: " + currentQuest.reward + " EXP";
  document.getElementById('quest-text').classList.add('flicker');
  notify("Quest Accepted: "+currentQuest.name);
}

function completeQuest(){
  if(!currentQuest){
    notify("No active quest!");
    return;
  }

  // Mark quest as done
  var q = dailyQuests.find(d=>d.name===currentQuest.name) || bonusQuests.find(b=>b.name===currentQuest.name);
  if(q) q.done = true;

  notify("Quest Completed: " + currentQuest.name + " → " + currentQuest.reward + " EXP");
  currentQuest = null;
  document.getElementById('quest-text').innerText = "No active quest";
  document.getElementById('quest-text').classList.remove('flicker');

  // Check if all daily quests done → increase streak
  if(dailyQuests.every(d=>d.done)){
    streak++;
    notify("Daily Quests Completed! Streak: "+streak);
  }

  renderQuests();
  saveGame();
}

function completeDaily(index){
  var q = dailyQuests[index];
  if(!q.done){
    q.done = true;
    notify(q.name+" completed! +" + q.reward + " EXP");
    renderQuests();
    saveGame();
  }
}

function completeBonus(index){
  var q = bonusQuests[index];
  if(!q.done){
    q.done = true;
    notify(q.name+" completed! +" + q.reward + " EXP");
    renderQuests();
    saveGame();
  }
}

/* ================= INIT ================= */
loadGame();
renderQuests();
document.getElementById('accept-btn').addEventListener('click', acceptQuest);
document.getElementById('complete-btn').addEventListener('click', completeQuest);
</script>

</body>
</html>
